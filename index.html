<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>MNet</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/shpjs@5.0.0/dist/shp.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/togeojson/0.16.0/togeojson.min.js"></script>

  <style>

:root {
  --top-bar-height: 56px;
  --panel-right: 22px;
  --panel-top-offset: 14px;
  --control-button-size: 28px;
  --control-icon-size: 14px;
  --panel-gap: 10px;
  --layer-menu-offset: calc(var(--panel-right) + var(--control-button-size) + var(--panel-gap) + 12px);
}

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }

    #map { position: fixed; inset: 0; width: 100vw; height: 100vh; }


    /* Top Navigation Bar */
    .top-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: var(--top-bar-height);
      background: #0d0d17;
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      gap: 16px;
    }

    .top-bar-left,
    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .top-bar-left {
      flex: 1;
    }

    .top-bar-right {
      justify-content: flex-end;
    }

    .search-anchor {
      display: flex;
      align-items: center;
      min-width: 220px;
      margin-right: -90px;
    }

    .top-bar-right > *:last-child {
      margin-right: 0;
    }

    .anon-banner {
      color: #c5cbe8;
      font: 600 13px/1.4 'Segoe UI', Arial, sans-serif;
      letter-spacing: 0.02em;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      padding: 6px 16px;
    }

    @media (max-width: 960px) {
      .anon-banner {
        display: none;
      }
    }

    #profile-button { cursor: pointer; }
    .profile-menu {
      position: absolute;
      right: var(--panel-right);
      top: calc(var(--top-bar-height) + 16px);
      width: 320px;
      max-height: 520px;
      overflow-y: auto;
      background: #ffffff;
      color: #111;
      border: 1px solid #e2e8f0;
      border-radius: 18px;
      box-shadow: 0 16px 40px rgba(13, 15, 35, 0.24);
      padding: 20px;
      z-index: 10000;
    }

    @media (max-width: 720px) {
      .profile-menu {
        right: 50%;
        transform: translateX(50%);
        width: min(92vw, 320px);
      }

      .search-anchor {
        min-width: 0;
        flex: 1 1 auto;
      }
    }

    .profile-avatar-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #1f3763;
      color: #fff;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font: 600 14px 'Segoe UI', Arial, sans-serif;
      letter-spacing: 0.04em;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      transition: background 0.2s ease;
    }

    .profile-avatar-btn:hover {
      background: #274a86;
    }

    .profile-avatar-text {
      text-transform: uppercase;
    }

    .profile-menu-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    .profile-menu-eyebrow {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #64748b;
      margin-bottom: 4px;
    }

    .profile-menu-heading {
      font-weight: 600;
      font-size: 16px;
      color: #101828;
    }

    .profile-menu-link {
      background: none;
      border: none;
      color: #1f3763;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      padding: 4px 0;
    }

    .profile-menu-link:hover {
      text-decoration: underline;
    }

    .profile-menu-search {
      margin: 14px 0;
    }

    .profile-menu-search input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid #d0d4dd;
      background: #f8fafc;
      font: 14px 'Segoe UI', Arial, sans-serif;
      color: #101828;
    }

    .profile-menu-search input:focus {
      outline: none;
      border-color: #1f3763;
      box-shadow: 0 0 0 3px rgba(31,55,99,0.18);
    }

    .profile-section-heading {
      font: 600 15px 'Segoe UI', Arial, sans-serif;
      margin-bottom: 10px;
    }

    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .profile-input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d0d4dd;
      background: #f8fafc;
      font: 14px 'Segoe UI', Arial, sans-serif;
      color: #101828;
    }

    .profile-input:focus {
      outline: none;
      border-color: #1f3763;
      box-shadow: 0 0 0 2px rgba(31,55,99,0.18);
    }

    .profile-action-btn {
      width: 100%;
      justify-content: center;
    }

    .profile-signout {
      margin-top: 16px;
    }

    .profile-menu-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    .profile-menu-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #475467;
    }

    .profile-menu-card {
      border: 1px solid #e4e7ec;
      border-radius: 12px;
      background: #f9fafb;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .profile-menu-card-eyebrow {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #475467;
    }

    .profile-menu-card-heading {
      font-size: 14px;
      font-weight: 600;
      color: #101828;
    }

    .profile-menu-card-sub {
      font-size: 13px;
      color: #475467;
    }

    .profile-menu-card-pill {
      align-self: flex-start;
      background: #1f3763;
      color: #fff;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .latlon-status {
      position: fixed;
      bottom: clamp(12px, 3vh, 20px);
      right: calc(var(--panel-right) + var(--control-button-size) + 28px);
      padding: 6px 14px;
      border-radius: 10px;
      background: rgba(13, 13, 23, 0.85);
      color: #f5f5f5;
      font-size: 12px;
      font-family: 'Segoe UI', Arial, sans-serif;
      letter-spacing: 0.02em;
      box-shadow: 0 6px 16px rgba(0,0,0,0.22);
      pointer-events: none;
      z-index: 2200;
    }

    .upload-btn {

      position: relative;

      display: inline-flex;

      align-items: center;

      gap: 6px;

      padding: 6px 12px;

      border-radius: 6px;

      background: #1f3763;

      color: #fff;

      font-size: 13px;

      cursor: pointer;

      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);

      border: none;

      user-select: none;

    }

    .upload-btn input {

      position: absolute;

      inset: 0;

      opacity: 0;

      cursor: pointer;

    }

    .upload-btn:hover {

      background: #274a86;

    }

    /* Coverage Button styling */

    .coverage-btn {

      width: var(--control-button-size);

      height: var(--control-button-size);

      border: none;

      outline: none;

      cursor: pointer;

      background: #fff;

      border-radius: 6px;

      display: flex;

      align-items: center;

      justify-content: center;

      position: relative;

      box-shadow: 0 1px 4px rgba(0,0,0,0.3);

      font-family: Arial, sans-serif;

      font-size: calc(var(--control-icon-size) * 0.55);

      color: #1f3763;

      transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;

    }

    .coverage-btn:hover {

      background: #eef2ff;

      box-shadow: 0 2px 6px rgba(0,0,0,0.25);

    }

    .coverage-btn.simulation svg {

      width: 18px;

      height: 18px;

      fill: currentColor;

      transition: transform 0.2s ease;

    }

    .coverage-btn.simulation.active {

      background: #1f3763;

      color: #fff;

      box-shadow: 0 2px 8px rgba(31,55,99,0.45);

    }

    .coverage-btn.simulation.active svg {

      transform: scale(1.05);

    }

    .coverage-btn span {

      position: absolute;

      bottom: calc(var(--control-button-size) * 0.12);

      font-weight: bold;
      font-size: calc(var(--control-button-size) * 0.28);

    }

    .map-control-panel .coverage-btn {
      border-radius: 50%;
    }

    .map-control-panel .coverage-btn span {
      width: 100%;
      text-align: center;
    }

    /* State 0: Empty circle */

    .cov-state-0::before {

      content: "";

      width: calc(var(--control-button-size) * 0.6);

      height: calc(var(--control-button-size) * 0.6);

      border: 2px solid #b0b0b0;

      border-radius: 50%;

      position: absolute;

    }

    /* States 1-6: small blue dot + number (5..30) */

    [class^="cov-state-"]:not(.cov-state-0):not(.cov-state-7):not(.cov-state-8)::before {

      content: "";

      width: calc(var(--control-button-size) * 0.35);

      height: calc(var(--control-button-size) * 0.35);

      background: #1f3763;

      border-radius: 50%;

      position: absolute;

      top: calc(var(--control-button-size) * 0.3);

    }

    /* State 7: filled dark blue circle + number 40 */

    .cov-state-7::before {

      content: "";

      width: calc(var(--control-button-size) * 0.6);

      height: calc(var(--control-button-size) * 0.6);

      background: #1f3763;

      border-radius: 50%;

      position: absolute;

      top: calc(var(--control-button-size) * 0.2);

    }

    .cov-state-7 span { color: white; }

    /* State 8: concentric blue shades (simulation icon) */

    .cov-state-8::before {

      content: "";

      width: calc(var(--control-button-size) * 0.75);

      height: calc(var(--control-button-size) * 0.75);

      border-radius: 50%;

      background: radial-gradient(

        circle,

        rgba(31,55,99,0.6) 0%,

        rgba(31,55,99,0.3) 50%,

        rgba(31,55,99,0.1) 100%

      );

      position: absolute;

    }


    .map-control-panel {
      position: absolute;
      top: calc(var(--top-bar-height) + var(--panel-top-offset));
      right: var(--panel-right);
      z-index: 2100;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #d9dfec;
      box-shadow: 0 12px 24px rgba(0,0,0,0.16);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--panel-gap);
      padding: 12px;
    }


    .control-button {
      background: #fff;
      border: 1px solid #d9dfec;
      border-radius: 50%;
      width: var(--control-button-size);
      height: var(--control-button-size);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
      color: #1f3763;
      position: relative;
      transition: background 0.18s ease, border-color 0.18s ease;
    }


    .control-button:hover {
      background: #eef1ff;
      border-color: #c3cce2;
    }

    .control-button img,
    .control-button span,
    .control-button svg {
      width: var(--control-icon-size);
      height: var(--control-icon-size);
      font-size: var(--control-icon-size);
      line-height: var(--control-icon-size);
    }

    .control-button span {
      font-weight: 600;
    }

    .control-button.upload {
      overflow: hidden;
    }

    .control-button.upload input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .control-button.layers svg {
      stroke: currentColor;
    }

    .control-button.layers.active {
      background: #1f3763;
      color: #fff;
    }

    .control-button.layers.active svg {
      fill: currentColor;
    }

    .map-options {
      position: absolute;
      top: calc(var(--top-bar-height) + var(--panel-top-offset));
      right: var(--layer-menu-offset);
      z-index: 2150;
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #d9dfec;
      box-shadow: 0 12px 24px rgba(0,0,0,0.14);
      padding: 10px;
      display: none;
      flex-direction: column;
      gap: var(--panel-gap);
    }

    .map-options button {
      font: 600 13px/1.2 'Segoe UI', Arial, sans-serif;
      background: #f3f5ff;
      color: #172242;
      border: 1px solid transparent;
      padding: 8px 12px;
      border-radius: 8px;
      text-align: left;
      cursor: pointer;
      transition: background 0.18s ease, border-color 0.18s ease;
    }

    .map-options button:hover {
      background: #e3e9ff;
      border-color: #c3cce2;
    }

    .map-options button.active {
      background: #1f3763;
      color: #fff;
      border-color: #1f3763;
    }

    @media (max-width: 720px) {
      .map-control-panel {
        top: calc(var(--top-bar-height) + 12px);
        right: 16px;
        padding: 10px;
        border-radius: 10px;
      }

      .map-options {
        right: 16px;
      }
    }

    

</style>

</head>

<body>

  <!-- Top Navigation Bar -->

  <div class="top-bar">
    <div class="top-bar-left">
      <div id="anon-banner" class="anon-banner">
        You're anonymous - uploads vanish when you close the browser.
      </div>
    </div>
    <div class="top-bar-right">
      <div id="topCenter" class="search-anchor"></div>
      <button id="profile-button" class="profile-avatar-btn" type="button" title="Account">
        <span id="profile-avatar-text" class="profile-avatar-text">??</span>
      </button>
    </div>
  </div>

  <!-- Profile dropdown -->
  <div id="profile-menu" class="profile-menu" style="display:none;">
    <div id="profile-signed-out">
      <div class="profile-section-heading">Sign in</div>
      <form id="signin-form" class="profile-form">
        <input id="signin-email" class="profile-input" type="email" placeholder="you@example.com"/>
        <input id="signin-password" class="profile-input" type="password" placeholder="Password"/>
        <button id="signin-submit" class="upload-btn profile-action-btn" type="submit">Sign in</button>
      </form>
    </div>

    <div id="profile-signed-in" style="display:none;">
      <div class="profile-menu-top">
        <div>
          <div class="profile-menu-eyebrow" id="profile-subtitle">MNet Cloud</div>
          <div class="profile-menu-heading">Hello, <span id="profile-display-name">there</span></div>
        </div>
        <button type="button" class="profile-menu-link" id="profile-preferences-btn">Preferences ></button>
      </div>
      <div class="profile-menu-search">
        <input type="search" id="profile-search" placeholder="Search" autocomplete="off"/>
      </div>
      <div class="profile-menu-section">
        <div class="profile-menu-section-title">My Account</div>
        <div class="profile-menu-card">
          <div class="profile-menu-card-eyebrow">Currently Viewing</div>
          <div class="profile-menu-card-heading" id="profile-account-name">MNet Cloud</div>
          <div class="profile-menu-card-sub" id="profile-email"></div>
          <span class="profile-menu-card-pill" id="profile-role-pill" style="display:none;"></span>
        </div>
      </div>
      <button id="signout-submit" class="upload-btn profile-action-btn profile-signout" type="button">
        Sign out
      </button>
    </div>
  </div>

<!-- Map Container -->

  <div id="map"></div>
  <div id="latLonDisplay" class="latlon-status">Lat, Lon: --</div>

  <!-- Combined Map Control Panel -->
  <div class="map-control-panel">
    <button id="coverageBtn" class="coverage-btn cov-state-0" type="button" title="Coverage Rings">
      <span></span>
    </button>
    <button id="simulationBtn" class="coverage-btn simulation" type="button" title="Toggle Simulation">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 6L18 12L9 18V6Z" fill="currentColor"/>
      </svg>
    </button>
    <button id="measureBtn" class="coverage-btn" type="button" title="Measure Distance">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14.5 5.49989L16 6.99989M11.5 8.49989L13 9.99989M8.49996 11.4999L9.99996 12.9999M5.49996 14.4999L6.99996 15.9999M2.56561 17.5656L6.43424 21.4342C6.63225 21.6322 6.73125 21.7313 6.84542 21.7683C6.94584 21.801 7.05401 21.801 7.15443 21.7683C7.2686 21.7313 7.3676 21.6322 7.56561 21.4342L21.4342 7.56561C21.6322 7.3676 21.7313 7.2686 21.7683 7.15443C21.801 7.05401 21.801 6.94584 21.7683 6.84542C21.7313 6.73125 21.6322 6.63225 21.4342 6.43424L17.5656 2.56561C17.3676 2.3676 17.2686 2.2686 17.1544 2.2315C17.054 2.19887 16.9458 2.19887 16.8454 2.2315C16.7313 2.2686 16.6322 2.3676 16.4342 2.56561L2.56561 16.4342C2.3676 16.6322 2.2686 16.7313 2.2315 16.8454C2.19887 16.9458 2.19887 17.054 2.2315 17.1544C2.2686 17.2686 2.3676 17.3676 2.56561 17.5656Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <button id="layerToggle" class="control-button layers" type="button" title="Base Maps" aria-haspopup="true" aria-controls="mapOptions" aria-expanded="false">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 7L12 3L21 7L12 11L3 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M3 12L12 16L21 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M3 17L12 21L21 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <label class="control-button upload" title="Upload Layer">
      <input type="file" id="layerFileInput" accept=".zip,.kml,.geojson,.json" />
      <img src="Assets/upload.svg" alt="Upload" />
    </label>
    <button class="control-button" type="button" onclick="locateMe()" title="Locate me">
      <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="Locate"/>
    </button>
    <button class="control-button" type="button" onclick="map.zoomIn()" aria-label="Zoom in"><span>+</span></button>
    <button class="control-button" type="button" onclick="map.zoomOut()" aria-label="Zoom out"><span>-</span></button>
  </div>

  <!-- Map type selection panel -->

  <div class="map-options" id="mapOptions">

    <button type="button" data-layer="street" onclick="switchLayer('street')">Street</button>

    <button type="button" data-layer="satellite" onclick="switchLayer('satellite')">Satellite</button>

    <button type="button" data-layer="hybrid" onclick="switchLayer('hybrid')">Hybrid</button>

  </div>

  <!-- Leaflet JS -->

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>

    // Base layers

    const street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {

      attribution: '&copy; OpenStreetMap contributors'

    });

    const satellite = L.tileLayer(

      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',

      { attribution: 'Imagery &copy; Esri' }

    );

    const esriLabels = L.tileLayer(

      'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',

      { attribution: 'Labels &copy; Esri' }

    );

    const esriRoads = L.tileLayer(

      'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}',

      { attribution: 'Roads &copy; Esri' }

    );

    const hybrid = L.layerGroup([satellite, esriRoads, esriLabels]);

    const baseLayers = { street, satellite, hybrid };

    // Map

    window.map = L.map('map', {

      zoom: 10,

      layers: [hybrid],

      zoomControl: false

    });

    let currentBaseLayer = hybrid;

    // Smoother camera moves (must come AFTER map is created)

    map.options.zoomSnap = 0.15;

    map.options.zoomDelta = 0.15;

    map.options.zoomAnimation = true;

    map.options.easeLinearity = 0.15;

    // Geolocate user

    if (navigator.geolocation) {

      navigator.geolocation.getCurrentPosition(

        ({ coords }) => map.setView([coords.latitude, coords.longitude], 13),

        () => map.setView([-31.95289, 115.85152], 10) // Brisbane fallback

      );

    } else {

      map.setView([-27.4698, 153.0251], 10);

    }

    const mapOptionsPanel = document.getElementById('mapOptions');
    const layerToggleButton = document.getElementById('layerToggle');
    const layerButtons = mapOptionsPanel ? Array.from(mapOptionsPanel.querySelectorAll('button[data-layer]')) : [];

    const latLonDisplay = document.getElementById('latLonDisplay');
    let latLonHideTimer = null;
    if (latLonDisplay) {
      const mapContainer = map.getContainer();
      const scheduleHide = () => {
        if (latLonHideTimer) clearTimeout(latLonHideTimer);
        latLonHideTimer = setTimeout(() => latLonDisplay.classList.remove('visible'), 1200);
      };
      map.on('mousemove', ({ latlng }) => {
        latLonDisplay.textContent = `Lat, Lon: ${latlng.lat.toFixed(5)}, ${latlng.lng.toFixed(5)}`;
        latLonDisplay.classList.add('visible');
        scheduleHide();
      });
      mapContainer.addEventListener('mouseleave', () => {
        if (latLonHideTimer) clearTimeout(latLonHideTimer);
        latLonDisplay.classList.remove('visible');
      });
      mapContainer.addEventListener('mouseenter', () => {
        if (latLonHideTimer) clearTimeout(latLonHideTimer);
      });
    }

    function setLayerPanel(open) {
      if (!mapOptionsPanel || !layerToggleButton) return;
      mapOptionsPanel.style.display = open ? 'flex' : 'none';
      layerToggleButton.classList.toggle('active', open);
      layerToggleButton.setAttribute('aria-expanded', open ? 'true' : 'false');
    }

    function toggleLayerPanel() {
      if (!mapOptionsPanel) return;
      const isOpen = mapOptionsPanel.style.display === 'flex';
      setLayerPanel(!isOpen);
    }

    function highlightActiveLayer(layerKey) {
      if (!layerButtons.length) return;
      layerButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.layer === layerKey);
      });
    }

    if (layerToggleButton && mapOptionsPanel) {
      layerToggleButton.addEventListener('click', event => {
        event.stopPropagation();
        toggleLayerPanel();
      });

      document.addEventListener('click', event => {
        if (!mapOptionsPanel.contains(event.target) && !layerToggleButton.contains(event.target)) {
          setLayerPanel(false);
        }
      });

      document.addEventListener('keydown', event => {
        if (event.key === 'Escape') {
          setLayerPanel(false);
        }
      });

      setLayerPanel(false);
    }

    highlightActiveLayer('hybrid');

    function switchLayer(type) {
      const nextLayer = baseLayers[type];
      if (!nextLayer) return;

      if (nextLayer !== currentBaseLayer) {
        map.addLayer(nextLayer);
        if (currentBaseLayer) {
          map.removeLayer(currentBaseLayer);
        }
        currentBaseLayer = nextLayer;
      }

      highlightActiveLayer(type);
      setLayerPanel(false);
    }

    let userLocationMarker = null;

    // Center map on user

    function locateMe() {

      if (!navigator.geolocation) {

        alert('Geolocation is not supported by your browser.');

        return;

      }

      navigator.geolocation.getCurrentPosition(

        ({ coords }) => {

          const position = [coords.latitude, coords.longitude];

          map.setView(position, 15);

          if (userLocationMarker) {

            map.removeLayer(userLocationMarker);

          }

          userLocationMarker = L.marker(position).addTo(map)

            .bindPopup('You are here').openPopup();

        },

        err => alert('Unable to retrieve your location.\n' + err.message)

      );

    }

    window.switchLayer = switchLayer;


    window.locateMe = locateMe;

  </script>

  <!-- Create the map + helpers BEFORE loading base-stations.js -->



  <!-- Modules -->
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/data.js"></script>
  <script type="module" src="js/ui-auth.js"></script>
  <script type="module" src="js/data-bridge.js"></script>
  <script type="module" src="js/db-ingest.js"></script>
  <script type="module" src="js/base-stations.js"></script>
  <script type="module" src="js/layer-upload.js"></script>
  <script type="module" src="js/address-search.js"></script>
  <script type="module" src="js/auto-open-all.js"></script>


</body>

</html>





